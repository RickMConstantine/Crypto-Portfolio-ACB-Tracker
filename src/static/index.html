<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Asset Portfolio & ACB Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; }
    .tabs { display: flex; cursor: pointer; margin-bottom: 1em; }
    .tab { padding: 1em; border: 1px solid #ccc; border-bottom: none; }
    .tab.active { background: #eee; }
    .tab-content { border: 1px solid #ccc; padding: 1em; }
    /* Modal styles */
    #edit-transaction-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.3);
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #edit-transaction-modal.active {
      display: flex;
    }
    #edit-transaction-modal .modal-content {
      background: #fff;
      padding: 2em;
      border-radius: 8px;
      min-width: 350px;
    }
    #edit-transaction-modal label { display: block; margin-top: 0.5em; }
    #edit-transaction-modal button { margin-top: 1em; }
    #edit-transaction-modal #delete-transaction-btn { margin-left: 1em; color: #fff; background: #d9534f; }
    #edit-transaction-modal #edit-transaction-error { color: red; margin-top: 0.5em; }
    #edit-price-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.3);
      align-items: center;
      justify-content: center;
      z-index: 1100;
    }
    #edit-price-modal.active {
      display: flex;
    }
    #edit-price-modal .modal-content {
      background: #fff;
      padding: 2em;
      border-radius: 8px;
      min-width: 350px;
      max-width: 95vw;
      max-height: 95vh;
      overflow: auto;
      position: relative;
    }
    #edit-price-modal label { display: block; margin-top: 0.5em; }
    #edit-price-modal button { margin-top: 1em; }
    #edit-price-modal #delete-price-btn { margin-left: 1em; color: #fff; background: #d9534f; }
    #edit-price-modal #edit-price-error { color: red; margin-top: 0.5em; }
    /* Edit Asset Modal styles */
    #edit-asset-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.3);
      align-items: center;
      justify-content: center;
      z-index: 1200;
    }
    #edit-asset-modal.active {
      display: flex;
    }
    #edit-asset-modal .modal-content {
      background: #fff;
      padding: 2em;
      border-radius: 8px;
      min-width: 350px;
    }
    #edit-asset-modal label { display: block; margin-top: 0.5em; }
    #edit-asset-modal button { margin-top: 1em; }
    #edit-asset-modal #delete-asset-btn { margin-left: 1em; color: #fff; background: #d9534f; }
    #edit-asset-modal #refresh-prices-btn { margin-left: 1em; color: #fff; background: #f39c12; }
    #edit-asset-modal #edit-asset-error { color: red; margin-top: 0.5em; }
  </style>
</head>
<body>
  <h1>Asset Portfolio & ACB Tracker</h1>
  <div class="tabs">
    <div class="tab active" data-tab="assets">Assets</div>
    <div class="tab" data-tab="prices">Prices</div>
    <div class="tab" data-tab="transactions">Transactions</div>
    <div class="tab" data-tab="tax">Tax</div>
  </div>
  <!-- Asset Tab -->
  <div class="tab-content" id="assets-content">
    <!-- <details>
      <summary>API Keys</summary>
      <div style="margin-top:0.5em;">
        <span>CryptoCompare: </span><input type="text" id="cryptocompare-api-key" placeholder="Enter CryptoCompare API Key" style="width:300px;">
      </div>
      <div style="margin-top:0.5em;">
        <span>Finage: </span><input type="text" id="finage-api-key" placeholder="Enter Finage API Key" style="width:300px;">
      </div>
    </details> -->
    <h2>Fiat Currency</h2>
    <form id="fiat-currency-form">
      <input type="text" name="symbol" placeholder="Enter fiat currency (e.g. CAD, USD)" required>
      <button type="submit">Set Fiat</button>
    </form>
    <table id="fiat-currency-table" border="1" style="margin-top:0.5em;">
      <thead>
        <tr>
          <th>Fiat Currency</th>
          <th>Logo</th>
        </tr>
      </thead>
      <tbody>
        <!-- Populated in index.js -->
      </tbody>
    </table>
    <div id="fiat-currency-error" style="color:red; margin-top:0.5em;"></div>
    <h2>Blockchain Assets</h2>
    <button id="open-edit-asset-modal-btn" style="margin-bottom:1em;">Add Asset</button>
    <table id="assets-table" border="1">
      <thead>
        <tr>
          <th>Name</th>
          <th>Symbol</th>
          <th>Launch Date</th>
          <th>Logo</th>
          <th>NFT</th>
        </tr>
      </thead>
      <tbody>
        <!-- Populated in index.js -->
      </tbody>
    </table>
  </div>
  <!-- Add/Edit Asset Modal -->
  <div id="edit-asset-modal" class="modal">
    <div class="modal-content">
      <h2 id="edit-asset-title">Edit Asset</h2>
      <form id="edit-asset-form">
        <div>
          <label for="edit-asset-symbol">Symbol:</label>
          <input type="text" id="edit-asset-symbol" name="symbol" required />
        </div>
        <details style="margin-top:1em;">
          <summary>Advanced Options</summary>
          <div>
            <label for="edit-asset-name">Name:</label>
            <input type="text" id="edit-asset-name" name="name" />
          </div>
          <!-- <div>
            <label for="edit-asset-type">Asset Type:</label>
            <select id="edit-asset-type" name="type" required>
              <option value="blockchain">Blockchain</option>
              <option value="fiat">Fiat</option>
            </select>
          </div> -->
          <div>
            <label for="edit-asset-logo-url">Logo URL:</label>
            <input type="text" id="edit-asset-logo-url" name="logo_url" />
          </div>
          <div>
            <label for="edit-asset-launch-date">Launch Date:</label>
            <input type="date" id="edit-asset-launch-date" name="launch_date" />
          </div>
          <div>
            <label for="edit-asset-is-nft">NFT:</label>
            <input type="checkbox" id="edit-asset-is-nft" name="is_nft" />
          </div>
        </details>
        <div id="edit-asset-error" style="color:#d9534f;"></div>
        <div style="margin-top:1em;">
          <button type="submit" id="save-asset-btn">Save</button>
          <button type="button" id="delete-asset-btn" style="display:none;">Delete</button>
          <button type="button" id="cancel-edit-asset-modal">Cancel</button>
          <button type="button" id="refresh-prices-btn">Refresh Prices</button>
        </div>
      </form>
    </div>
  </div>
  <!-- Prices Tab -->
  <div class="tab-content" id="prices-content" style="display:none;">
    <h2>Prices</h2>
    <button id="open-edit-price-modal-btn" style="margin-bottom:1em;">Add Price</button>
    <div id="prices-filters" style="margin-bottom:1em;">
      <label>Asset:
        <select id="prices-filter-asset">
          <option value="">All</option>
        </select>
      </label>
      <label>Fiat:
        <select id="prices-filter-fiat">
          <option value="">All</option>
        </select>
      </label>
      <label>Date From:
        <input type="date" id="prices-filter-date-from">
      </label>
      <label>Date To:
        <input type="date" id="prices-filter-date-to">
      </label>
      <button id="prices-filter-btn">Filter</button>
      <button id="prices-filter-reset-btn" type="button">Reset</button>
    </div>
    <table id="prices-table" border="1">
      <thead>
        <tr>
          <th>Date</th>
          <th>Price</th>
          <th>Asset Symbol</th>
          <th>Fiat Symbol</th>
        </tr>
      </thead>
      <tbody>
        <!-- Populated in index.js -->
      </tbody>
    </table>
  </div>
  <!-- Add/Edit Price Modal -->
  <div id="edit-price-modal">
    <div class="modal-content">
      <h3 id="edit-price-title">Edit Price</h3>
      <form id="edit-price-modal-form">
        <label>Date:
          <input type="date" name="date" id="edit-price-date" required>
        </label>
        <label>Price:
          <input type="number" name="price" id="edit-price-value" placeholder="Price" required step="any">
        </label>
        <label>Asset Symbol:
          <select name="asset_symbol" id="edit-price-asset-symbol" required></select>
        </label>
        <button type="submit">Save</button>
        <button type="button" id="delete-price-btn">Delete</button>
        <button type="button" id="cancel-edit-price-modal">Cancel</button>
        <div id="edit-price-error"></div>
      </form>
    </div>
  </div>
  <!-- Transactions Tab -->
  <div class="tab-content" id="transactions-content" style="display:none;">
    <h2>Transactions</h2>
    <button id="open-add-import-modal-btn" style="margin-bottom:1em;">Add/Import Transaction</button>
    <div id="transactions-filters" style="margin-bottom:1em;">
      <label>Asset:
        <select id="transactions-filter-asset">
          <option value="">All</option>
          <!-- Populated in index.js -->
        </select>
      </label>
      <label>Type:
        <select id="transactions-filter-type">
          <option value="">All</option>
          <!-- Populated in index.js -->
        </select>
      </label>
      <label>Date From:
        <input type="date" id="transactions-filter-date-from">
      </label>
      <label>Date To:
        <input type="date" id="transactions-filter-date-to">
      </label>
      <button id="transactions-filter-btn">Filter</button>
      <button id="transactions-filter-reset-btn" type="button">Reset</button>
    </div>
    <table id="transactions-table" border="1">
      <thead>
        <tr>
          <th>ID</th><th>Date</th><th>Type</th>
          <th>Send Symbol</th><th>Send Qty</th>
          <th>Receive Symbol</th><th>Receive Qty</th>
          <th>Fee Symbol</th><th>Fee Qty</th>
          <th>Income</th><th>Notes</th>
        </tr>
      </thead>
      <tbody>
        <!-- Populated in index.js -->
      </tbody>
    </table>
  </div>
  <div class="tab-content" id="tax-content" style="display:none;">
    <h2>Asset Summary</h2>
    <table id="tax-acb-table" border="1">
      <thead>
        <tr>
          <th>Asset Symbol</th>
          <th>Adjusted Cost Base (ACB)</th>
          <th>Total Units</th>
          <th>Total Proceeds</th>
          <th>Total Costs</th>
          <th>Total Outlays</th>
          <th>Total Gain/Loss</th>
          <th>Superficial Losses</th>
          <th>Total Income</th>
        </tr>
      </thead>
      <tbody>
        <!-- Populated in index.js -->
      </tbody>
    </table>
    <h2 style="margin-top:2em;">Yearly Reports</h2>
    <table id="tax-yearly-aggregates-table" border="1">
      <thead>
        <tr>
          <th>Year</th>
          <th>Total ACB</th>
          <th>Total Proceeds</th>
          <th>Total Costs</th>
          <th>Total Outlays</th>
          <th>Total Gain/Loss</th>
          <th>Total Superficial Losses</th>
          <th>Total Income</th>
        </tr>
      </thead>
      <tbody>
        <!-- Populated in index.js -->
      </tbody>
    </table>
  </div>
  <!-- Add/Edit Transaction Modal -->
  <div id="edit-transaction-modal">
    <div class="modal-content">
      <h3 id="edit-transaction-title">Edit Transaction</h3>
      <form id="edit-transaction-form">
        <label>Date:
          <input type="datetime-local" name="date" id="edit-date" step="1" required>
        </label>
        <label>Type:
          <select name="type" id="edit-type-select" required></select>
        </label>
        <label>Send Asset:
          <select name="send_asset_symbol" id="edit-send-asset-select"></select>
        </label>
        <label>Send Qty:
          <input type="number" step="any" name="send_asset_quantity" id="edit-send-asset-quantity">
        </label>
        <label>Receive Asset:
          <select name="receive_asset_symbol" id="edit-receive-asset-select"></select>
        </label>
        <label>Receive Qty:
          <input type="number" step="any" name="receive_asset_quantity" id="edit-receive-asset-quantity">
        </label>
        <label>Fee Asset:
          <select name="fee_asset_symbol" id="edit-fee-asset-select"></select>
        </label>
        <label>Fee Qty:
          <input type="number" step="any" name="fee_asset_quantity" id="edit-fee-asset-quantity">
        </label>
        <label>Income:
          <input type="checkbox" name="is_income" id="edit-is-income">
        </label>
        <label>Notes:
          <input type="text" name="notes" id="edit-notes">
        </label>
        <button type="submit" id="edit-save-btn">Save</button>
        <button type="button" id="delete-transaction-btn">Delete</button>
        <button type="button" id="close-edit-modal">Cancel</button>
        <div id="edit-transaction-error"></div>
      </form>
      <div id="import-transactions-container" style="margin:2em 0 0 0; display:none;">
        <h3>Import Transactions</h3>
        <label>Import Transactions (CSV):
          <input type="file" id="import-transactions-file" accept=".csv">
        </label>
        <button id="import-transactions-btn">Upload</button>
        <button id="download-csv-btn" type="button">Download CSV</button>
        <span id="import-transactions-status" style="margin-left:1em;color:#d9534f;"></span>
      </div>
    </div>
  </div>
  <script>var exports = {};</script>
  <script src="./index.js"></script>
</body>
</html>
